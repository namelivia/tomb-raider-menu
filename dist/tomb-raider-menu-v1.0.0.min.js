/*! tomb-raider-menu v1.0.0 - 2015-06-02 
 *  License: GPL2 */

var TombRaiderMenu=function(a){this.objects=[],window.Detector.webgl||window.Detector.addGetWebGLMessage();var b=document.getElementById(a),c=b.offsetWidth,d=b.offsetHeight;this.clock=new window.THREE.Clock,this.scene=new window.THREE.Scene,this.camera=new window.THREE.PerspectiveCamera(50,c/d,1,1e5),this.renderer=new window.THREE.WebGLRenderer({alpha:!0}),this.renderer.setSize(c,d),b.appendChild(this.renderer.domElement);var e=new window.THREE.AmbientLight(16637848),f=new window.THREE.DirectionalLight(16777215);f.position.set(0,100,30).normalize(),this.scene.add(f,e),this.newScene(),this.update()};TombRaiderMenu.prototype.goToLink=function(a){window.location.href=a},TombRaiderMenu.prototype.newScene=function(){this.cameraAngle=0,this.angleStep=0,this.setRadius(6e3),this.setCameraDistance(12e3),this.setCameraHeight(3e3),this.deleteAllObjects(),this.selected=0,this.selectedRotate=0},TombRaiderMenu.prototype.moveLeft=function(){this.objects.length&&(this.selected=this.mod(this.selected+1,this.objects.length)),this.selectedRotate+=1},TombRaiderMenu.prototype.moveRight=function(){this.objects.length&&(this.selected=this.mod(this.selected-1,this.objects.length)),this.selectedRotate-=1},TombRaiderMenu.prototype.addModel=function(a,b,c,d){var e={name:a,model:b,action:c,params:d};this.loadModel(e,this.scene,this.objects)},TombRaiderMenu.prototype.getSelectedName=function(){return this.objects[this.selected]?this.objects[this.selected].name:void 0},TombRaiderMenu.prototype.action=function(){if(this.objects[this.selected])switch(this.objects[this.selected].action){case"link":this.goToLink(this.objects[this.selected].params);break;default:console.error("Unknown action")}},TombRaiderMenu.prototype.getRadius=function(){return this.radius},TombRaiderMenu.prototype.getCameraDistance=function(){return this.cameraDistance},TombRaiderMenu.prototype.getCameraHeight=function(){return this.camera.position.y},TombRaiderMenu.prototype.setRadius=function(a){this.radius=a},TombRaiderMenu.prototype.setCameraHeight=function(a){this.camera.position.y=a},TombRaiderMenu.prototype.setCameraDistance=function(a){this.cameraDistance=a},TombRaiderMenu.prototype.update=function(){requestAnimationFrame(TombRaiderMenu.prototype.update.bind(this));this.clock.getDelta();if(this.cameraAngle!==this.angleStep*this.selectedRotate&&(this.cameraAngle=this.cameraAngle<this.angleStep*this.selectedRotate?this.cameraAngle+(this.angleStep*this.selectedRotate-this.cameraAngle)/10:this.cameraAngle-(this.cameraAngle-this.angleStep*this.selectedRotate)/10),this.camera.position.x=Math.cos(this.cameraAngle)*this.cameraDistance,this.camera.position.z=Math.sin(this.cameraAngle)*this.cameraDistance,this.camera.lookAt(new window.THREE.Vector3(0,0,0)),this.objects.length)for(var a=0;a<this.objects.length;a++)a===this.selected&&(this.objects[a].rotation.y+=.01),this.objects[a].position.x=Math.cos(this.angleStep*a)*this.radius,this.objects[a].position.z=Math.sin(this.angleStep*a)*this.radius;this.render()},TombRaiderMenu.prototype.render=function(){this.renderer.render(this.scene,this.camera)},TombRaiderMenu.prototype.mod=function(a,b){return(a%b+b)%b},TombRaiderMenu.prototype.deleteAllObjects=function(){for(;this.objects.length>0;)this.deleteSelected()},TombRaiderMenu.prototype.deleteSelected=function(){var a=this.objects[this.selected];this.scene.remove(a),this.objects.splice(this.selected,1),this.selected>0&&this.moveLeft()},TombRaiderMenu.prototype.setConfig=function(a){this.newScene();try{a=JSON.parse(a)}catch(b){alert("Error parsing the JSON configuration")}this.setRadius(parseInt(a.radius)),this.setCameraDistance(parseInt(a.distance)),this.setCameraHeight(parseInt(a.height));for(var c=a.objects.length,d=0;c>d;d++)this.addModel(a.objects[d].name,a.objects[d].model,a.objects[d].action,a.objects[d].params)},TombRaiderMenu.prototype.getConfig=function(){var a={},b=this.objects.map(function(a){return{name:a.name,action:a.action,params:a.params,model:a.model}});return a.objects=b,a.distance=this.getCameraDistance(),a.height=this.getCameraHeight(),a.radius=this.getRadius(),JSON.stringify(a)},TombRaiderMenu.prototype.loadModel=function(a,b,c){var d=new window.THREE.JSONLoader;d.load(a.model,function(d,e){var f=new window.THREE.MeshFaceMaterial(e),g=new window.THREE.Mesh(d,f);b.add(g),g.name=a.name,g.action=a.action,g.params=a.params,g.model=a.model,c.push(g),this.angleStep=360/c.length*(Math.PI/180)}.bind(this))};var tombraidermenu=function(a){var b=new TombRaiderMenu(a);return b};
//# sourceMappingURL=tomb-raider-menu-v1.0.0.min.js.map